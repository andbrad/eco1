---
title: "ESM 201 Assignment 1"
author: "Brad Anderson"
date: "February 9, 2018"
output:
  html_document: default
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}

library(tidyverse)
library(stargazer)
library(car)
library(knitr)

```

```{r data}

countries <- read_csv("C:/Users/Brad/github/eco1/data/countries.csv")

```

```{r create two dataframes}

ugandadf <- countries %>% 
  filter( country == "Uganda")


```

```{r uganda growth rate}

plot(ugandadf$year, ugandadf$population, xlab="year", ylab="world population")

```

```{r Nt-1}

ugandadf$yearminus1<-(ugandadf$year-1) # add a column for the previous year 

# Create N_(t-1) column 
ugandadf$popminus1<-ugandadf$population[match(ugandadf$yearminus1, ugandadf$year)]

```

```{r dn/ndt}

ugandadf$dNNdt<-log(ugandadf$population/ugandadf$popminus1)*1/(ugandadf$year-ugandadf$yearminus1)

#Plot results
plot(ugandadf$population, ugandadf$dNNdt, xlab="Nt", ylab="dN/Ndt")  # N OR N-1 HERE?

plot(ugandadf$year, ugandadf$dNNdt, xlab="year", ylab="dN/Ndt")
```

```{r uganda models}

ugandalm_1<-lm(dNNdt~population, data=ugandadf[ugandadf$year<=1980,])
ugandalm_2<-lm(dNNdt~population, data=ugandadf[ugandadf$year>1980,])

par(mfrow=c(2,2))
plot(ugandalm_1) 

par(mfrow=c(2,2)) #Set parameters for plotting a 2x2 window
plot(ugandalm_2) # need to run this line at the same time as the one above to get 4-panel plot



```

Diagnostic plots seem OK.....

```{r uganda fitted plot}

# make base plot 
plot(dNNdt~population, data=ugandadf, xlab="Nt", ylab="dN/Ndt", xlim=c(0, 50000), ylim=c(0,0.05))

# add lines of best fit for both linear models 
abline(ugandalm_1, col="darkgrey")
abline(ugandalm_2, col="darkgrey")

# add within-sample predictions from both linear models 
dNNdt_pred1<-predict(ugandalm_1)
dNNdt_pred2<-predict(ugandalm_2) 

lines(x=ugandadf$population[ugandadf$year<=1980 & ugandadf$year>1961], y=dNNdt_pred1, col="red") # remove first year, for which there is no prediction (since there was no N-1) 
lines(x=ugandadf$population[ugandadf$year>1980], y=dNNdt_pred2, col="blue")

```
According to current trends, Uganda will not reach K.

```{r mlr}

uganda_mlr <- lm(dNNdt ~ food_pc + education + hiv + population, data = ugandadf)

summary(uganda_mlr)

AIC(uganda_mlr)
```

```{r mlr diagnostics}

par(mfrow=c(2,2))
plot(uganda_mlr)

```

```{r collinearity}

pairs(ugandadf[4:6])

```

```{r stargazer, include=FALSE, results = 'asis'}

stargazer(uganda_mlr, type = "html")

```

